# 数据库

## 1 事务

ACID：原子性、一致性、隔离性、持久性

## 2 并发一致性问题

丢失修改、读脏数据、不可重复读、幻影读

## 3 封锁

封锁粒度：行级锁、表级锁【锁开销和并发程度权衡】

读写锁：互斥锁、共享锁

意向锁：想在表中某个数据行加锁

## 4 封锁协议

一级封锁协议：解决丢失修改

二级封锁协议：解决读脏数据

三级封锁协议：解决不可重复读

## 5 隔离级别

![img](https://camo.githubusercontent.com/1632a88a3a4fa7954026cb939edf2f8a30bb5d60a1bce4921c7e0d0e4d245739/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232333430303738372e706e67)

## 6 多版本并发控制

+ 写操作更新最新的版本快照，而读操作去读旧版本快照
+ MVCC 规定只能读取已经提交的快照。当然一个事务可以读取自身未提交的快照
+ 修改操作会新增一个版本快照
+ ReadView：保存 TRX_IDs

## 7 Next-Key Locks

+ 目的为解决幻影读
+ Record Locks：锁定一个记录的索引
+ Gap Locks：锁定索引之间的间隙
+ 锁定前开后闭区间

